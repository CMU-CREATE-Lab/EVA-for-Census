<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Visualization</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/css/bootstrap.min.css"> 
    <link href="css/slider.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.js"></script>
    <script src="js/modernizr.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/vis.js"></script>
    <script src="js/TrackballControls.js"></script>
    <script src="js/stats.min.js"></script>
    <script>
      var mapping = {x: -1, y: -1, z: -1, c: -1, t: -1};
      var mapDimension = function(dropdownId, dimensionName, dimensionIndex) {
        if (dropdownId == "xDimensionDropdown") { mapping.x = dimensionIndex; }
        else if (dropdownId == "yDimensionDropdown") { mapping.y = dimensionIndex; }
        else if (dropdownId == "zDimensionDropdown") { mapping.z = dimensionIndex; }
        else if (dropdownId == "cDimensionDropdown") { mapping.c = dimensionIndex; }
        else if (dropdownId == "tDimensionDropdown") { mapping.t = dimensionIndex; }
        $('#' + dropdownId).html(dimensionName.substr(0,9) + ' <span class="caret"></span>');
        initialDraw(mapping);
      };

      $(document).ready(function(){

        $('td').tooltip({'selector': '', 'placement': 'left', container: 'body'});

        var oldZ = -100, oldF = -100, oldD = -100, z, f, d;

        var getSliderVals = function() {
          z = (parseFloat($('#zSlider').attr('data-slider-max')) - Z.getValue() + parseFloat($('#zSlider').attr('data-slider-min')));
          $('#Zindicator').text(z.toFixed(1));
          f = (parseFloat($('#fSlider').attr('data-slider-max')) - F.getValue() + parseFloat($('#fSlider').attr('data-slider-min')))/10;
          $('#Findicator').text(f.toFixed(1));
          d = (parseFloat($('#dSlider').attr('data-slider-max')) - D.getValue() + parseFloat($('#dSlider').attr('data-slider-min')))/10;
          $('#Dindicator').text(d.toFixed(2));
        };

        var changed = function() {
          getSliderVals();
          if (z != oldZ) {
            draw(z, f, d);
            oldZ = z;
          }
          if (d != oldD) {
            draw(z, f, d);
            oldD = d;
          }
          if (f != oldF) {
            draw(z, f, d);
            oldF = f;
          }
        };

        var Z = $('#zSlider').slider()
        .on('slide', changed)
        .data('slider');

        var F = $('#fSlider').slider()
        .on('slide', changed)
        .data('slider');

        var D = $('#dSlider').slider()
        .on('slide', changed)
        .data('slider');

        getSliderVals();
        
        $.getJSON('data/weather/weather.json', function(datapoints) {
          // adding data dimensions to dimension mapping dropdowns
          $('.dimension-mapper').each(function(d) {
            var dropdownId = '';
            if (d == 0) { dropdownId = 'xDimensionDropdown'; }
            else if (d == 1) { dropdownId = 'yDimensionDropdown'; }
            else if (d == 2) { dropdownId = 'zDimensionDropdown'; }
            else if (d == 3) { dropdownId = 'cDimensionDropdown'; }
            else {dropdownId = 'tDimensionDropdown'; }
            var newHTML = '<li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="mapDimension(\'' + dropdownId + '\',\'NONE\',-1);">NONE</a></li>\n<li role="presentation" class="divider"></li>\n';
            datapoints[0].forEach(function(e, i, a){
              newHTML += '<li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="mapDimension(\'' + dropdownId + '\',\'' + e + '\',' + i + ');">' + e + '</a></li>\n';
            });
            jQuery(this).html(newHTML);
          });

          init($('#drawCanvas'), $('#stat'), datapoints);
        });

      });
    </script>
  </head>
  <body>
    <div id="stat"></div>
    <div id="drawCanvas"></div>

    <div id="params3">
      <div class="panel panel-info">
        <div class="panel-heading">
          <h3 class="panel-title">Dimension Mapping</h3>
        </div>
        <ul class="nav nav-pills">

          <li class="active">
            <a href="#">X: </a>
          </li>
          <li class="dropdown">
          <a id="xDimensionDropdown" role="button" data-toggle="dropdown" href="#">
            NONE
            <span class="caret"></span>
          </a>
            <ul class="dropdown-menu dimension-mapper" role="menu" aria-labelledby="xDimensionDropdown">
            </ul>
          </li>

          <li class="active">
            <a href="#">Y: </a>
          </li>
          <li class="dropdown">
            <a id="yDimensionDropdown" role="button" data-toggle="dropdown" href="#">
              NONE
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu dimension-mapper" role="menu" aria-labelledby="yDimensionDropdown">
            </ul>
          </li>

          <li class="active">
            <a href="#">Z: </a>
          </li>
          <li class="dropdown">
            <a id="zDimensionDropdown" role="button" data-toggle="dropdown" href="#">
              NONE
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu dimension-mapper" role="menu" aria-labelledby="zDimensionDropdown">
            </ul>
          </li>
         
          <li class="active">
            <a href="#">Color: </a>
          </li>
          <li class="dropdown">
            <a id="cDimensionDropdown" role="button" data-toggle="dropdown" href="#">
              NONE
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu dimension-mapper" role="menu" aria-labelledby="cDimensionDropdown">
            </ul>
          </li>

          <li class="active">
            <a href="#">Time: </a>
          </li>
          <li class="dropdown">
            <a id="tDimensionDropdown" role="button" data-toggle="dropdown" href="#">
              NONE
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu dimension-mapper" role="menu" aria-labelledby="tDimensionDropdown">
            </ul>
          </li>

        </ul>
      </div>
    </div>

    <div id="params1">

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Parameters</h3>
        </div>
        <table class="table tablenoborder">
          <tr>
            <td>
              <input type="text" class="span2" value="" data-slider-min="-20" data-slider-max="20" data-slider-step="0.1" data-slider-value="-0.001" id="zSlider" data-slider-id="ZS" data-slider-orientation="vertical" data-slider-tooltip="hide" data-slider-selection="after">
            </td>
            <td>
              <input type="text" class="span2" value="" data-slider-min="0" data-slider-max="100" data-slider-step="0.1" data-slider-value="100" id="fSlider" data-slider-id="FS" data-slider-orientation="vertical" data-slider-tooltip="hide" data-slider-selection="after">
            </td>
            <td>
              <input type="text" class="span2" value="" data-slider-min="1" data-slider-max="10" data-slider-step="0.1" data-slider-value="10" id="dSlider" data-slider-id="DS" data-slider-orientation="vertical" data-slider-tooltip="hide" data-slider-selection="after">
            </td>
            <tr>
              <td data-toggle="tooltip" title="Z value of the last data point">H</td>
              <td data-toggle="tooltip" title="Number of cycles">C</td>
              <td data-toggle="tooltip" title="Distance between two consecutive datapoints">D</td>
            </tr>
          </table>
        </div>

        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">Information</h3>
          </div>
          <table class="table table-striped">
            <tr>
              <td><b>Height</b></td>
              <td id="Zindicator"></td>
            </tr>
            <tr>
              <td><b>Cycles</b></td>
              <td id="Findicator"></td>
            </tr>
            <tr>
              <td><b>Distance</b></td>
              <td id="Dindicator"></td>
            </tr>
            <tr>
              <td><b>Time Steps</b></td>
              <td id="tsindicator"></td>
            </tr>
            <tr>
              <td><b>Events</b></td>
              <td id="eventsindicator"></td>
            </tr>
          </table>
        </div>

      </div>

      <div id="params2">

        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">Camera Type</h3>
          </div>
          <form>
            <div class="radio">
              <label>
                <input type="radio" name="cameraRadios" id="perspectiveRadio" onclick="setCameraType('perspective');" checked>Perspective
              </label>
            </div>

            <div class="radio">
              <label>
                <input type="radio" name="cameraRadios" id="orthographicRadio" onclick="setCameraType('orthographic');">Orthographic
              </label>
            </div>
          </form>
        </div>

        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">Settings</h3>
          </div>
          <form>
            <div class="checkbox">
              <label>
                <input type="checkbox" onclick="setLine(this.checked);" checked>
                Show Timeline
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" onclick="setAxisHelper(this.checked);" checked>
                Axis Helper
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" onclick="setGridXY(this.checked);">
                Grid XY Helper
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" onclick="setGridXZ(this.checked);">
                Grid XZ Helper
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" onclick="setGridYZ(this.checked);">
                Grid YZ Helper
              </label>
            </div>
          </form>
        </div>

        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">Camera Orientation</h3>
          </div>
          <p><button type="button" class="btn btn-danger btn-block" onclick="setCameraX();">Look from X</button></p>
          <p><button type="button" class="btn btn-success btn-block" onclick="setCameraY();">Look from Y</button></p>
          <p><button type="button" class="btn btn-primary btn-block" onclick="setCameraZ();">Look from Z</button></p>
        </div>

      </div>

    </body>
  </html>
